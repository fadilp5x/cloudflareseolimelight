<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Limelight - Article</title>
    
    <meta name="description" content="">
    <meta name="author" content="">
    <meta property="og:type" content="article">
    <meta property="og:url" content="">
    <meta property="og:title" content="">
    <meta property="og:description" content="">
    <meta property="og:image" content="">
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="">
    <meta property="twitter:title" content="">
    <meta property="twitter:description" content="">
    <meta property="twitter:image" content="">

    <link rel="icon" type="image/png" sizes="32x32" href="https://i.ibb.co/WN46nq9w/favicon-32x32.png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Roboto:wght@300;400;500&display=swap" rel="stylesheet">
    <style>
        :root, :root[data-theme='light'] {
            --primary-color: #fff;
            --secondary-color: #f8f9fa;
            --accent-color: #8B4513;
            --text-color: #333;
            --light-gray: #e9ecef;
            --border-color: #dee2e6;
            --tag-bg: #f8f0f5;
            --tag-text: #9c27b0;
            --btn-bg: #9c27b0;
            --card-shadow: 0 4px 12px rgba(0,0,0,0.08);
            --footer-bg: #1a1a1a;
            --footer-text: #ccc;
        }
        :root[data-theme='dark'] {
            --primary-color: #1a1a1a;
            --secondary-color: #2c2c2c;
            --text-color: #ccc;
            --light-gray: #3a3a3a;
            --border-color: #444;
            --footer-bg: #111;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html { scroll-behavior: smooth; }
        body { font-family: 'Roboto', sans-serif; background-color: var(--primary-color); color: var(--text-color); line-height: 1.6; transition: background-color 0.3s, color 0.3s; }
        .page-wrapper { display: flex; justify-content: center; }
        .main-container { max-width: 1200px; width: 100%; display: grid; grid-template-columns: 1fr 800px 1fr; gap: 2rem; padding: 0 20px; }
        .left-sidebar, .right-sidebar { padding-top: 40px; }
        .sticky-sidebar-item { position: sticky; top: 40px; }
        a { color: var(--text-color); text-decoration: none; transition: color 0.3s ease; }
        a:hover { color: var(--accent-color); }
        .loading-bar { position: fixed; top: 0; left: 0; height: 3px; width: 100%; background: var(--accent-color); z-index: 10000; transform-origin: left; transform: scaleX(0); }
        .header { padding: 15px 0; border-bottom: 1px solid var(--border-color); position: relative; z-index: 100; background-color: var(--primary-color); }
        .header-content { display: flex; justify-content: space-between; align-items: center; max-width: 1200px; margin: 0 auto; padding: 0 20px; }
        .site-title img { max-height: 65px; width: auto; }
        .nav-menu { display: flex; list-style: none; align-items: center; }
        .nav-item { margin: 0 15px; position: relative; }
        /* Article Styles */
        .article-page { margin: 40px 0; }
        .article-meta { margin-bottom: 30px; text-align: center; }
        .category-tag { font-family: 'Playfair Display', serif; font-size: 16px; color: var(--accent-color); margin-bottom: 15px; display: inline-block; }
        .article-title { font-family: 'Playfair Display', serif; font-size: 42px; margin-bottom: 20px; line-height: 1.2; }
        .author-profile { display: flex; align-items: center; justify-content: center; gap: 15px; margin-bottom: 30px; }
        .author-avatar { width: 60px; height: 60px; border-radius: 50%; object-fit: cover; }
        .featured-image { width: 100%; height: auto; max-height: 500px; object-fit: cover; margin-bottom: 30px; border-radius: 4px; }
        .article-body { font-size: 18px; line-height: 1.8; margin-bottom: 40px; font-family: 'Georgia', serif; }
        .article-body p, .article-body ul, .article-body ol { margin-bottom: 20px; }
        .article-body h2, .article-body h3 { font-family: 'Playfair Display', serif; margin: 40px 0 20px; color: var(--accent-color); }
        .article-body h2 { font-size: 28px; }
        .article-body h3 { font-size: 24px; }
        /* Floating Social Share Bar */
        .floating-share { display: flex; flex-direction: column; gap: 15px; align-items: center; }
        .floating-share .share-title { font-size: 10px; text-transform: uppercase; letter-spacing: 1px; color: #999; writing-mode: vertical-rl; transform: rotate(180deg); margin-bottom: 10px; }
        .floating-share a { width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; border-radius: 50%; border: 1px solid var(--border-color); transition: all 0.3s; }
        .floating-share a:hover { background-color: var(--secondary-color); transform: scale(1.1); }
        /* Table of Contents */
        #toc-container { font-size: 14px; }
        #toc-container h4 { font-family: 'Playfair Display', serif; margin-bottom: 15px; }
        #toc-container ul { list-style: none; padding-left: 0; }
        #toc-container ul li a { display: block; padding: 5px 0; border-left: 2px solid transparent; padding-left: 10px; }
        #toc-container ul li a.active { border-left-color: var(--accent-color); font-weight: 500; }
        #toc-container ul ul { padding-left: 15px; } /* Nested list for H3 */
        /* Author Quick Info */
        .author-quick-info { text-align: center; border: 1px solid var(--border-color); padding: 20px; border-radius: 4px; }
        .author-quick-info img { width: 70px; height: 70px; border-radius: 50%; object-fit: cover; margin-bottom: 10px; }
        .author-quick-info h5 { font-family: 'Playfair Display', serif; font-size: 18px; }
        .author-quick-info p { font-size: 14px; color: #888; margin-top: 10px; }
        /* Theme Toggle */
        .theme-toggle { cursor: pointer; display: flex; align-items: center; justify-content: center; width: 40px; height: 40px; }
        /* Back to Top Button */
        #backToTopBtn { position: fixed; bottom: 30px; right: 30px; width: 45px; height: 45px; background: var(--accent-color); color: white; border: none; border-radius: 50%; display: none; align-items: center; justify-content: center; cursor: pointer; z-index: 100; opacity: 0; transition: opacity 0.3s, transform 0.3s; }
        #backToTopBtn.show { opacity: 1; display: flex; }
        /* Footer */
        .site-footer { background-color: var(--footer-bg); color: var(--footer-text); padding: 60px 0 0; font-size: 15px; }
        .footer-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 30px; max-width: 1200px; margin: 0 auto; padding-bottom: 40px; border-bottom: 1px solid #444; }
        .footer-bottom { padding: 20px 0; text-align: center; font-size: 14px; }
        /* Mobile Adjustments */
        @media (max-width: 1100px) {
            .main-container { grid-template-columns: 800px; justify-content: center; }
            .left-sidebar, .right-sidebar { display: none; }
        }
        @media (max-width: 768px) {
            .main-container { grid-template-columns: 1fr; }
            .article-title { font-size: 32px; }
        }
    </style>
</head>
<body>
    <div class="loading-bar" id="readingProgressBar"></div>
    
    <header class="header">
        <div class="header-content">
            <div class="site-title"><a href="/index.html"><img src="https://i.ibb.co/NdsYM9dx/web-logo-123.png" alt="The Limelight Online Logo"></a></div>
            <nav class="nav-menu" id="categoryNav"></nav>
        </div>
    </header>

    <div class="page-wrapper">
        <div class="main-container">
            <aside class="left-sidebar">
                <div class="sticky-sidebar-item">
                    <div class="floating-share" id="floatingShareBar">
                        <span class="share-title">Share</span>
                        <a href="#" id="shareFacebook" aria-label="Share on Facebook"><i class="fab fa-facebook-f"></i></a>
                        <a href="#" id="shareTwitter" aria-label="Share on Twitter"><i class="fab fa-twitter"></i></a>
                        <a href="#" id="shareEmail" aria-label="Share by Email"><i class="fas fa-envelope"></i></a>
                        <div class="theme-toggle" id="themeToggle"><i class="fas fa-moon"></i></div>
                    </div>
                </div>
            </aside>
            <main>
                <div class="article-page" id="articleContainer"></div>
            </main>
            <aside class="right-sidebar">
                <div class="sticky-sidebar-item">
                    <div id="authorQuickInfo" class="author-quick-info" style="margin-bottom: 2rem;"></div>
                    <div id="toc-container"></div>
                </div>
            </aside>
        </div>
    </div>

    <footer class="site-footer">
        <div class="footer-grid">
           </div>
        <div class="footer-bottom"><p>Copyright Â© 2025. The Limelight Online. All rights reserved.</p></div>
    </footer>

    <button id="backToTopBtn" aria-label="Back to top"><i class="fas fa-arrow-up"></i></button>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        const SUPABASE_URL = 'https://whklfmxjknhucguzvpob.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Indoa2xmbXhqa25odWNndXp2cG9iIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTgyOTY5MjIsImV4cCI6MjA3Mzg3MjkyMn0.5Y2an8aYFc5wY64VmRJmnblYBPwLLs_CR9UXJ4XuzjM';
        const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        const pathParts = window.location.pathname.split('/');
        const postSlug = pathParts[pathParts.length - 1];
        
        const articleContainer = document.getElementById('articleContainer');
        const progressBar = document.getElementById('readingProgressBar');
        const backToTopBtn = document.getElementById('backToTopBtn');
        const themeToggle = document.getElementById('themeToggle');
        
        async function fetchArticle() {
            const { data: article, error } = await supabaseClient
                .from('posts')
                .select(`*, authors(*), categories(*)`)
                .eq('slug', postSlug)
                .single();
            
            if (error || !article) {
                articleContainer.innerHTML = `<div style="text-align: center; padding: 50px;"><h1>Article Not Found</h1><p>The article you're looking for doesn't exist.</p><a href="/index.html">Return to Homepage</a></div>`;
                return;
            }
            
            renderArticle(article);
            setupReadingProgress();
            setupTableOfContents();
            setupShareLinks(article);
            setupAuthorQuickInfo(article.authors);
        }

        function renderArticle(article) {
            document.title = `${article.title} | The Limelight`;
            articleContainer.innerHTML = `
                <div class="article-meta">
                    <a href="/index.html?categories=${article.categories.slug}" class="category-tag">${article.categories.name}</a>
                    <h1 class="article-title">${article.title}</h1>
                    <div class="author-profile">
                        <a href="/index.html?author=${article.authors.id}"><img src="${article.authors.avatar_url || 'https://via.placeholder.com/60'}" alt="${article.authors.full_name}" class="author-avatar"></a>
                        <div>By <a href="/index.html?author=${article.authors.id}">${article.authors.full_name}</a></div>
                    </div>
                </div>
                <img src="${article.image_url}" alt="${article.title}" class="featured-image">
                <div class="article-body" id="articleBody">${article.content}</div>`;
        }

        function setupTableOfContents() {
            const articleBody = document.getElementById('articleBody');
            const tocContainer = document.getElementById('toc-container');
            if (!articleBody || !tocContainer) return;

            const headings = articleBody.querySelectorAll('h2, h3');
            if (headings.length < 2) {
                tocContainer.style.display = 'none';
                return;
            }

            let tocHtml = '<h4>In This Article</h4><ul>';
            let activeHeadings = new Map();

            headings.forEach((heading, index) => {
                const id = `heading-${index}`;
                heading.id = id;
                const level = heading.tagName === 'H2' ? 1 : 2;
                
                tocHtml += `<li class="toc-level-${level}"><a href="#${id}">${heading.textContent}</a></li>`;
                activeHeadings.set(heading, document.querySelector(`a[href="#${id}"]`));
            });
            tocHtml += '</ul>';
            tocContainer.innerHTML = tocHtml;

            // Active link highlighting on scroll
            const observer = new IntersectionObserver(entries => {
                entries.forEach(entry => {
                    const link = activeHeadings.get(entry.target);
                    if (entry.isIntersecting && entry.intersectionRatio >= 0.75) {
                        link.classList.add('active');
                    } else {
                        link.classList.remove('active');
                    }
                });
            }, { threshold: 0.75 });

            headings.forEach(h => observer.observe(h));
        }

        function setupReadingProgress() {
            window.addEventListener('scroll', () => {
                const scrollTop = window.scrollY;
                const docHeight = document.documentElement.scrollHeight - window.innerHeight;
                const scrollPercent = (scrollTop / docHeight) * 100;
                progressBar.style.transform = `scaleX(${scrollPercent / 100})`;
                
                // Back to top button
                if (window.scrollY > 300) {
                    backToTopBtn.classList.add('show');
                } else {
                    backToTopBtn.classList.remove('show');
                }
            });
        }
        
        function setupAuthorQuickInfo(author) {
            const infoBox = document.getElementById('authorQuickInfo');
            if (!infoBox) return;
            infoBox.innerHTML = `
                <a href="/index.html?author=${author.id}">
                    <img src="${author.avatar_url || 'https://via.placeholder.com/70'}" alt="${author.full_name}">
                    <h5>${author.full_name}</h5>
                </a>
                <p>${author.bio ? author.bio.substring(0, 100) + '...' : ''}</p>
            `;
        }
        
        function setupShareLinks(article) {
            const url = window.location.href;
            const title = article.title;
            document.getElementById('shareFacebook').href = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(url)}`;
            document.getElementById('shareTwitter').href = `https://twitter.com/intent/tweet?url=${encodeURIComponent(url)}&text=${encodeURIComponent(title)}`;
            document.getElementById('shareEmail').href = `mailto:?subject=${encodeURIComponent(title)}&body=${encodeURIComponent('Check out this article: ' + url)}`;
        }

        // --- Theme Toggle Logic ---
        const applyTheme = (theme) => {
            document.documentElement.setAttribute('data-theme', theme);
            themeToggle.innerHTML = theme === 'dark' ? '<i class="fas fa-sun"></i>' : '<i class="fas fa-moon"></i>';
            localStorage.setItem('limelight-theme', theme);
        };
        themeToggle.addEventListener('click', () => {
            const currentTheme = document.documentElement.getAttribute('data-theme') || 'light';
            const newTheme = currentTheme === 'light' ? 'dark' : 'light';
            applyTheme(newTheme);
        });
        const savedTheme = localStorage.getItem('limelight-theme') || 'light';
        applyTheme(savedTheme);
        
        // --- Back to Top Logic ---
        backToTopBtn.addEventListener('click', () => {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });

        document.addEventListener('DOMContentLoaded', () => {
            if (postSlug) { fetchArticle(); } 
            else { articleContainer.innerHTML = `<div style="text-align: center; padding: 50px;"><h1>Article Not Found</h1><p>No article specified.</p><a href="/index.html">Return to Homepage</a></div>`; }
        });
    </script>
</body>
</html>
